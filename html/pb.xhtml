<bsh>
import org.paw.util.*;
import org.apache.commons.fileupload.*;
import org.json.*;

outDir = "/sdcard/piratebox";
files = new ArrayList();
type = (String) request.headers.get("content-type");

success = false;

if (type != null && type.startsWith("multipart/form-data")) {
	try {
		// Create output directory if it does not exist
		if(!new File(outDir).exists()) {
			new File(outDir).mkdirs();
		}

		// Get the boundary string
		boundaryIndex = type.indexOf("boundary=");
		byte[] boundary = (type.substring(boundaryIndex + 9)).getBytes();

		// Construct a MultiPartStream with request.in as InputStream
		MultipartStream multipartStream =  new MultipartStream(request.in, boundary);
		boolean nextPart = multipartStream.skipPreamble();

		uploadedFiles = 0;

		// Loop through all parts
		while(nextPart) {
		  headers = multipartStream.readHeaders();

		  // If part is a file, save it to disk. Otherwise skip it.
		  if(headers.contains("filename=\"")) {
		     // Get filename
		     filename = headers.substring(headers.indexOf("filename=") + 10);
		     filename = filename.substring(0, filename.indexOf("\""));

		     // If filename is not empty save content to filesystem
		     if(filename.length() > 0) {
			files.add(filename);
			multipartStream.readBodyData(new FileOutputStream(outDir + "/" + filename));
			//speak(filename,new Locale("en","EN"));
                        showNotification(filename,"PirateBox upload",filename);
			uploadedFiles++;
		     }
                     else {
			multipartStream.discardBodyData();  
		     }
		  }
		  else {
		     multipartStream.discardBodyData();
		  }

		  nextPart = multipartStream.readBoundary();
		}
		success = uploadedFiles > 0 ? true : false;
	}
	catch(e) {
		success = false;
	}
	
}
</bsh>

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<title>PirateBox - file uploaded</title>
<link rel="stylesheet" href="css/default.css">
</head>
<body>
<div>
<center><bsh>print((success ? "File received!" : "<span style='color: red;'>Upload failed!</span>"));</bsh>&nbsp;&nbsp;&nbsp;<a href="index.html">Send another file</a></center> 
</div>
<center> 
<h1><script type="text/javascript">document.write(location.host)</script></h1>
 <table cellpadding="2">
<tr>
<td>
<img src="images/piratebox-logo-steampunk_lord-vincent.deviantart.com.png "  alt="SteamPunk PirateBox Logo" /> 
</td>
<td>
<a href="list.xhtml"><img src="images/loot.png" alt="Loot" border="0" width="150" height="66"><br><br>
<a href="about.html"><img src="images/aboot.png" alt="Aboot" border="0" width="150" height="66"><br><br>
</td> 
</tr>
</table>
 SteamBox skin: tribute to
http://GirlGeniusOnline.com<br>
and http://Lord-Vincent.DeviantArt.com 
</center> 
</body>
</html>
